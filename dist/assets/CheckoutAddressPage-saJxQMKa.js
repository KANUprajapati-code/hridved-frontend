import{b as z,u as D,c as H,j as e,a as C}from"./index-DsP1R5yV.js";import{b as O,r as o}from"./vendor-react-B8KVy-C4.js";import{C as k}from"./CheckoutStepIndicator-BMjnIS6w.js";import{A as E}from"./AnimatedPage-D9f9vAm_.js";import{A as N}from"./AnimatedButton-BHsbnN3-.js";import{S as q}from"./ScrollReveal-CR-2c4a2.js";import{c as R,o as U,P as I,u as Y,U as B}from"./vendor-ui-DMuw5F6C.js";import"./vendor-utils-C0Zqfgkc.js";function ee(){const h=O(),{user:j}=z(),{cart:l}=D(),{updateAddress:F,updateStep:P,setErrorMessage:n,clearError:m,checkoutData:g}=H(),[x,v]=o.useState([]),[c,u]=o.useState(null),[$,y]=o.useState(!1),[_,w]=o.useState(!0),[f,p]=o.useState(!1),[t,S]=o.useState({fullName:"",mobileNumber:"",pincode:"",state:"",city:"",houseNumber:"",landmark:"",addressType:"Home"}),[a,A]=o.useState({});o.useEffect(()=>{const s=async()=>{try{w(!0),m();const{data:r}=await C.get("/addresses");v(r),g.address?u(g.address._id):r.length>0&&u(r[0]._id)}catch(r){console.error("Error fetching addresses:",r),n("Failed to load addresses")}finally{w(!1)}};if(!j){h("/login");return}s()},[j,h,m,g.address,n]);const T=()=>{const s={};return t.fullName.trim()||(s.fullName="Full name is required"),t.mobileNumber.trim()||(s.mobileNumber="Mobile number is required"),/^\d{10}$/.test(t.mobileNumber)||(s.mobileNumber="Mobile must be 10 digits"),t.pincode.trim()||(s.pincode="Pincode is required"),/^\d{6}$/.test(t.pincode)||(s.pincode="Pincode must be 6 digits"),t.state.trim()||(s.state="State is required"),t.city.trim()||(s.city="City is required"),t.houseNumber.trim()||(s.houseNumber="House number/Area is required"),A(s),Object.keys(s).length===0},i=s=>{const{name:r,value:b}=s.target;S(d=>({...d,[r]:b})),a[r]&&A(d=>({...d,[r]:""}))},L=async s=>{var r,b;if(s.preventDefault(),!!T())try{p(!0),m();const{data:d}=await C.post("/addresses",t);v([...x,d]),u(d._id),y(!1),S({fullName:"",mobileNumber:"",pincode:"",state:"",city:"",houseNumber:"",landmark:"",addressType:"Home"})}catch(d){console.error("Error creating address:",d),n(((b=(r=d.response)==null?void 0:r.data)==null?void 0:b.message)||"Failed to create address")}finally{p(!1)}},M=async()=>{if(!c){n("Please select or add an address");return}try{p(!0),m();const s=x.find(r=>r._id===c);s&&(F(s),localStorage.setItem("shippingAddress",JSON.stringify(s)),P(2),h("/checkout/shipping"))}catch(s){console.error("Error:",s),n("Failed to proceed")}finally{p(!1)}};return _?e.jsx(E,{children:e.jsx("div",{className:"bg-background min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsx(k,{}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading addresses..."})]})]})})}):e.jsx(E,{children:e.jsx("div",{className:"bg-background min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsx(k,{}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl font-serif font-bold text-gray-900 mb-6",children:"Delivery Address"}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(R,{size:18,className:"text-primary"})," Your Saved Addresses"]}),x.length===0?e.jsx("div",{className:"bg-gray-50 border border-dashed border-gray-300 rounded-xl p-8 text-center text-gray-500 mb-6",children:e.jsx("p",{children:"No saved addresses found. Add a new address to continue."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:x.map((s,r)=>e.jsx(q,{delay:r*.1,children:e.jsxs("div",{className:`border-2 rounded-xl p-4 cursor-pointer transition-all relative h-full flex flex-col justify-between ${c===s._id?"border-primary bg-primary/5 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>u(s._id),children:[c===s._id&&e.jsx("div",{className:"absolute top-3 right-3 text-primary",children:e.jsx("div",{className:"bg-primary text-white rounded-full p-1",children:e.jsx(U,{size:12,strokeWidth:3})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-bold text-gray-900",children:s.fullName}),e.jsx("span",{className:"text-[10px] bg-gray-200 text-gray-700 px-2 py-0.5 rounded uppercase font-bold tracking-wider",children:s.addressType})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[e.jsxs("p",{children:[s.houseNumber,", ",s.landmark&&`${s.landmark}, `]}),e.jsxs("p",{children:[s.city,", ",s.state," - ",s.pincode]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 font-medium",children:[e.jsx(I,{size:14})," ",s.mobileNumber]})]})]})},s._id))})]}),e.jsx("div",{className:"mb-8",children:$?e.jsx(q,{children:e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:"Add New Address"}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-500 hover:text-red-500 text-sm font-medium",children:"Cancel"})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase",children:"Full Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{type:"text",name:"fullName",value:t.fullName,onChange:i,placeholder:"Enter your full name",className:`w-full pl-10 pr-4 py-2.5 rounded-lg border focus:ring-2 focus:ring-primary/20 outline-none transition-all ${a.fullName?"border-red-500":"border-gray-300 focus:border-primary"}`})]}),a.fullName&&e.jsx("span",{className:"text-xs text-red-500",children:a.fullName})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase",children:"Mobile Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-3 text-gray-400",size:16}),e.jsx("input",{type:"text",name:"mobileNumber",value:t.mobileNumber,onChange:i,placeholder:"10-digit mobile number",className:`w-full pl-10 pr-4 py-2.5 rounded-lg border focus:ring-2 focus:ring-primary/20 outline-none transition-all ${a.mobileNumber?"border-red-500":"border-gray-300 focus:border-primary"}`})]}),a.mobileNumber&&e.jsx("span",{className:"text-xs text-red-500",children:a.mobileNumber})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase",children:"Pincode *"}),e.jsx("input",{type:"text",name:"pincode",value:t.pincode,onChange:i,placeholder:"6-digit pincode",className:`w-full px-4 py-2.5 rounded-lg border focus:ring-2 focus:ring-primary/20 outline-none transition-all ${a.pincode?"border-red-500":"border-gray-300 focus:border-primary"}`}),a.pincode&&e.jsx("span",{className:"text-xs text-red-500",children:a.pincode})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase",children:"State *"}),e.jsx("input",{type:"text",name:"state",value:t.state,onChange:i,placeholder:"Enter state",className:`w-full px-4 py-2.5 rounded-lg border focus:ring-2 focus:ring-primary/20 outline-none transition-all ${a.state?"border-red-500":"border-gray-300 focus:border-primary"}`}),a.state&&e.jsx("span",{className:"text-xs text-red-500",children:a.state})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase",children:"City *"}),e.jsx("input",{type:"text",name:"city",value:t.city,onChange:i,placeholder:"Enter city",className:`w-full px-4 py-2.5 rounded-lg border focus:ring-2 focus:ring-primary/20 outline-none transition-all ${a.city?"border-red-500":"border-gray-300 focus:border-primary"}`}),a.city&&e.jsx("span",{className:"text-xs text-red-500",children:a.city})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase",children:"House Number / Area *"}),e.jsx("input",{type:"text",name:"houseNumber",value:t.houseNumber,onChange:i,placeholder:"House number, building name",className:`w-full px-4 py-2.5 rounded-lg border focus:ring-2 focus:ring-primary/20 outline-none transition-all ${a.houseNumber?"border-red-500":"border-gray-300 focus:border-primary"}`}),a.houseNumber&&e.jsx("span",{className:"text-xs text-red-500",children:a.houseNumber})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase",children:"Landmark (Optional)"}),e.jsx("input",{type:"text",name:"landmark",value:t.landmark,onChange:i,placeholder:"e.g., near XYZ store",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase",children:"Address Type *"}),e.jsx("div",{className:"flex gap-4 mt-1",children:["Home","Office"].map(s=>e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"addressType",value:s,checked:t.addressType===s,onChange:i,className:"mr-2 accent-primary w-4 h-4"}),e.jsx("span",{className:"text-sm text-gray-700",children:s})]},s))})]}),e.jsx(N,{type:"submit",disabled:f,className:"w-full bg-primary text-white py-3 rounded-xl font-bold hover:bg-opacity-90 transition-all shadow-md hover:shadow-lg disabled:bg-gray-300 disabled:cursor-not-allowed mt-4 border-none",children:f?"Adding Address...":"Save Address"})]})]})}):e.jsxs(N,{onClick:()=>y(!0),className:"w-full border-2 border-dashed border-primary/30 text-primary rounded-xl p-4 flex items-center justify-center gap-2 hover:bg-primary/5 font-bold transition-all",children:[e.jsx(Y,{size:20})," Add New Address"]})}),(l==null?void 0:l.cartItems)&&l.cartItems.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 mb-8 border border-gray-200 max-w-md ml-auto",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-4",children:"Price Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[l.cartItems.map(s=>e.jsxs("div",{className:"flex justify-between text-gray-500 text-xs",children:[e.jsxs("span",{children:[s.name," (x",s.qty,")"]}),e.jsxs("span",{children:["₹",(s.price*s.qty).toLocaleString()]})]},s.product||s._id)),e.jsx("div",{className:"border-t border-gray-300 my-2 pt-2"}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",l.cartItems.reduce((s,r)=>s+r.price*r.qty,0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tax (18%)"}),e.jsxs("span",{children:["₹",(Math.round(l.cartItems.reduce((s,r)=>s+r.price*r.qty,0)*.18*100)/100).toLocaleString()]})]}),e.jsxs("div",{className:"border-t border-gray-200 my-2 pt-2 flex justify-between font-bold text-gray-900 text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",(l.cartItems.reduce((s,r)=>s+r.price*r.qty,0)+Math.round(l.cartItems.reduce((s,r)=>s+r.price*r.qty,0)*.18*100)/100).toLocaleString()]})]})]}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-2 text-right",children:"* Shipping calculated at next step"})]}),e.jsx("div",{className:"flex justify-end pt-6 border-t border-gray-100",children:e.jsx(N,{onClick:M,disabled:!c||f,className:"w-full md:w-auto px-8 bg-primary text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-opacity-90 hover:shadow-xl transition-all transform hover:-translate-y-1 disabled:bg-gray-300 disabled:cursor-not-allowed border-none",children:"Continue to Shipping"})})]})]})})})}export{ee as default};
