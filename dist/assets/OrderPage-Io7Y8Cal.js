import{b as y,j as e,a as o}from"./index-jnhJKHVM.js";import{e as N,r as a,L as v}from"./vendor-react-B8KVy-C4.js";import{E as w,l as P,u as S,a as A,P as D}from"./vendor-payments-BKpIW0VL.js";import{h as O}from"./vendor-ui-cGIEGKxt.js";import"./vendor-utils-C0Zqfgkc.js";const k=({orderId:m,amount:s,onSuccess:i})=>{const n=S(),l=A(),[c,x]=a.useState(null),[p,d]=a.useState(!1),u=async b=>{if(b.preventDefault(),!n||!l)return;d(!0);const{error:h}=await n.confirmPayment({elements:l,confirmParams:{return_url:`${window.location.origin}/order/${m}`},redirect:"if_required"});h?(x(h.message),d(!1)):(x("Payment Processed"),i(),d(!1))};return e.jsxs("form",{onSubmit:u,className:"mt-4",children:[e.jsx(D,{}),c&&e.jsx("div",{className:"text-red-500 text-sm mt-2",children:c}),e.jsx("button",{disabled:p||!n||!l,id:"submit",className:"w-full bg-primary text-white py-3 rounded mt-4 hover:bg-opacity-90 transition font-bold disabled:opacity-50",children:e.jsx("span",{id:"button-text",children:p?"Processing ... ":"Pay Now"})})]})},L=()=>{const{id:m}=N(),[s,i]=a.useState(null),[n,l]=a.useState(!0),{user:c}=y(),[x,p]=a.useState(null),[d,u]=a.useState("");a.useEffect(()=>{(async()=>{try{const{data:t}=await o.get(`/orders/${m}`);if(i(t),!t.isPaid&&t.paymentMethod==="Stripe"){const{data:g}=await o.get("/config/stripe");p(P(g));const{data:f}=await o.post("/payment/create-payment-intent",{amount:Math.round(t.totalPrice*100),currency:"inr"});u(f.clientSecret)}}catch(t){console.error(t)}finally{l(!1)}})()},[m]);const b=async()=>{try{await o.put(`/orders/${s._id}/pay`,{}),i({...s,isPaid:!0,paidAt:new Date().toISOString()}),alert("Payment Successful")}catch(r){console.error(r),alert("Error updating order status")}},h=async()=>{try{await o.put(`/orders/${s._id}/deliver`),i({...s,isDelivered:!0,deliveredAt:new Date().toISOString()}),alert("Order Delivered")}catch(r){console.error(r),alert("Error updating order")}};if(n)return e.jsx("div",{className:"text-center py-20",children:"Loading..."});if(!s)return e.jsx("div",{className:"text-center py-20",children:"Order not found"});const j={clientSecret:d,appearance:{theme:"stripe",variables:{colorPrimary:"#053807"}}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("h1",{className:"text-3xl font-serif font-bold text-primary mb-4",children:["Order ",s._id]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsxs("div",{className:"md:w-2/3 space-y-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded shadow-sm border",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Shipping"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Name: "})," ",s.user.name]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Email: "})," ",e.jsx("a",{href:`mailto:${s.user.email}`,className:"text-secondary",children:s.user.email})]}),e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"Address: "}),s.shippingAddress.address,", ",s.shippingAddress.city," ",s.shippingAddress.postalCode,", ",s.shippingAddress.country]}),s.isDelivered?e.jsxs("div",{className:"bg-green-100 text-green-700 p-2 rounded",children:["Delivered on ",s.deliveredAt.substring(0,10)]}):e.jsx("div",{className:"bg-red-100 text-red-700 p-2 rounded",children:"Not Delivered"})]}),e.jsxs("div",{className:"bg-white p-6 rounded shadow-sm border",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Payment Method"}),e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"Method: "})," ",s.paymentMethod]}),s.isPaid?e.jsxs("div",{className:"bg-green-100 text-green-700 p-2 rounded",children:["Paid on ",s.paidAt.substring(0,10)]}):e.jsx("div",{className:"bg-red-100 text-red-700 p-2 rounded",children:"Not Paid"})]}),e.jsxs("div",{className:"bg-white p-6 rounded shadow-sm border",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Order Items"}),s.orderItems.length===0?e.jsx("p",{children:"Order is empty"}):e.jsx("div",{className:"space-y-4",children:s.orderItems.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-4 border-b last:border-0 pb-4 last:pb-0",children:[e.jsx("img",{src:r.image,alt:r.name,className:"w-12 h-12 rounded object-cover"}),e.jsx(v,{to:`/product/${r.product}`,className:"flex-1 hover:text-primary",children:r.name}),e.jsxs("div",{className:"text-gray-600",children:[r.qty," x ₹",r.price," = ",e.jsxs("span",{className:"font-bold text-gray-900",children:["₹",r.qty*r.price]})]})]},t))})]})]}),e.jsxs("div",{className:"md:w-1/3",children:[e.jsxs("div",{className:"bg-white p-6 rounded shadow-md border",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 border-b pb-2",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Items"}),e.jsxs("span",{children:["₹",s.itemsPrice]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",s.shippingPrice]})]}),e.jsxs("div",{className:"flex justify-between mt-4 pt-4 border-t font-bold text-xl text-primary mb-4",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",s.totalPrice]})]}),!s.isPaid&&s.paymentMethod==="Stripe"&&d&&e.jsx("div",{className:"border-t pt-4",children:e.jsx(w,{options:j,stripe:x,children:e.jsx(k,{orderId:s._id,amount:s.totalPrice,onSuccess:b})})}),!s.isPaid&&s.paymentMethod==="COD"&&e.jsx("div",{className:"bg-yellow-100 text-yellow-800 p-3 rounded text-center font-bold",children:"Cash on Delivery"}),!s.isPaid&&e.jsx("div",{className:"bg-red-100 p-4 rounded text-red-700 font-bold mb-4",children:"Not Paid"}),s.trackingId&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-200 mb-4",children:[e.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:"Shipment Tracking"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Courier: ",e.jsx("strong",{children:s.courierName})]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["AWB: ",e.jsx("strong",{children:s.trackingId})]}),e.jsxs("button",{onClick:()=>window.open(`/track-order?orderId=${s._id}`,"_blank"),className:"mt-2 text-sm bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2 w-fit",children:[e.jsx(O,{size:14})," Track Shipment"]})]})]}),c&&c.isAdmin&&!s.isDelivered&&e.jsx("div",{className:"bg-white p-6 rounded shadow-md border mt-4",children:e.jsx("button",{onClick:h,children:"Mark As Delivered"})})]})]})]})};export{L as default};
