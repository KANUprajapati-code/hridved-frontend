import{j as e,a as E,b as U,u as G,c as Q}from"./index-DsP1R5yV.js";import{r as o,b as W}from"./vendor-react-B8KVy-C4.js";import{C as Y}from"./CheckoutStepIndicator-BMjnIS6w.js";import{A as $}from"./AnimatedPage-D9f9vAm_.js";import{A as q}from"./AnimatedButton-BHsbnN3-.js";import{S as N}from"./ScrollReveal-CR-2c4a2.js";import{D as H,f as J,x as K,c as V,z as X,g as Z,B,k as ee}from"./vendor-ui-DMuw5F6C.js";import"./vendor-utils-C0Zqfgkc.js";const se=({amount:i,orderId:v,onSuccess:r,onError:s,onBeforePayment:u})=>{const[l,m]=o.useState(!1),P=async()=>{var x,b;try{m(!0);let d=v;if(u){const h=await u();if(!h)return;d=h._id}const{data:p}=await E.post("/payment/create",{amount:i,orderId:d});window.location.href=p}catch(d){console.error("Payment Initiation Failed:",d),s&&s(((b=(x=d.response)==null?void 0:x.data)==null?void 0:b.message)||"Something went wrong")}finally{m(!1)}};return e.jsx(q,{onClick:P,disabled:l,className:"w-full bg-primary text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-opacity-90 hover:shadow-xl transition-all flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed border-none",children:l?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"animate-spin",size:20}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Pay ₹",i.toLocaleString()," ",e.jsx(J,{size:20})]})})};function oe(){var S,I,C,z,L,A,O;const i=W(),{user:v}=U(),{cart:r}=G(),{checkoutData:s,updateStep:u,setErrorMessage:l,clearError:m,setOrderId:P}=Q(),[x,b]=o.useState(!1),[d,p]=o.useState(!1),[,h]=o.useState(null);o.useEffect(()=>{if(!s.address||!s.shippingMethod){i("/checkout/address");return}if(!(r!=null&&r.cartItems)||r.cartItems.length===0){i("/cart");return}},[s,i,r]);const w=()=>{const n=((r==null?void 0:r.cartItems)||[]).reduce((f,y)=>f+y.price*y.qty,0),a=Math.round(n*.18*100)/100,g=s.shippingCost||0,j=n+a+g;return{itemsPrice:n,taxPrice:a,shippingPrice:g,totalPrice:j}},D=async()=>{var t,n;try{p(!0),m();const{itemsPrice:a,taxPrice:g,shippingPrice:j,totalPrice:f}=w(),y=(r==null?void 0:r.cartItems)||[],{data:M}=await E.post("/checkout/create-order",{addressId:s.address._id,deliveryOption:s.shippingMethod,orderItems:y.map(c=>({name:c.name,qty:c.qty,image:c.image,price:c.price,product:c.product||c._id})),itemsPrice:a,taxPrice:g,shippingPrice:j,totalPrice:f});return h(M._id),M}catch(a){throw console.error("Error creating order:",a),l(((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to create order"),a}finally{p(!1)}},F=async t=>{t&&t.preventDefault()},{itemsPrice:R,taxPrice:_,shippingPrice:T,totalPrice:k}=w();return e.jsx($,{children:e.jsx("div",{className:"bg-background min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-5xl",children:[e.jsx(Y,{}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl font-serif font-bold text-gray-900 mb-6",children:"Payment"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{children:e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-4 flex items-center gap-2",children:[e.jsx(K,{size:16})," Order Summary"]}),e.jsx("div",{className:"space-y-4 mb-4",children:(r==null?void 0:r.cartItems)&&r.cartItems.map(t=>e.jsxs("div",{className:"flex justify-between items-start pb-4 border-b border-gray-200 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Qty: ",t.qty]})]}),e.jsxs("div",{className:"font-bold text-gray-900 text-sm",children:["₹",(t.price*t.qty).toLocaleString()]})]},t.product||t._id))}),e.jsxs("div",{className:"space-y-2 text-sm pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",R.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tax (5%)"}),e.jsxs("span",{children:["₹",_.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",T.toLocaleString()]})]}),e.jsxs("div",{className:"border-t border-gray-200 my-2 pt-2 flex justify-between font-bold text-gray-900 text-lg",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["₹",k.toLocaleString()]})]})]})]})}),e.jsx(N,{delay:.1,children:e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-4 flex items-center gap-2",children:[e.jsx(V,{size:16})," Delivery Address"]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:(S=s.address)==null?void 0:S.fullName}),e.jsxs("p",{children:[(I=s.address)==null?void 0:I.houseNumber,((C=s.address)==null?void 0:C.landmark)&&`, ${s.address.landmark}`]}),e.jsxs("p",{children:[(z=s.address)==null?void 0:z.city,", ",(L=s.address)==null?void 0:L.state," - ",(A=s.address)==null?void 0:A.pincode]}),e.jsx("p",{className:"pt-1 font-medium text-gray-700",children:(O=s.address)==null?void 0:O.mobileNumber})]})]})})]}),e.jsx("div",{children:e.jsx(N,{delay:.2,children:e.jsxs("form",{onSubmit:F,className:"bg-white rounded-xl border-2 border-primary/10 p-6 md:p-8 shadow-sm h-full flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(X,{size:20,className:"text-primary"})," Select Payment Method"]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center p-4 border-2 border-primary bg-primary/5 rounded-xl cursor-pointer transition-all relative",children:[e.jsx("div",{className:"absolute top-3 right-3 text-primary",children:e.jsx("div",{className:"bg-primary text-white rounded-full p-1",children:e.jsx(Z,{size:14,strokeWidth:3})})}),e.jsx("input",{type:"radio",name:"paymentMethod",value:"razorpay",defaultChecked:!0,className:"w-5 h-5 accent-primary mr-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:"Credit / Debit Card / UPI"}),e.jsx("div",{className:"text-xs text-primary font-bold bg-white border border-primary px-2 py-0.5 rounded inline-block mt-1",children:"Razorpay Secured"})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 text-sm text-gray-600 flex gap-3 items-start",children:[e.jsx(B,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{children:"Secure payment via Razorpay. All major credit/debit cards, UPI (Google Pay, PhonePe, Paytm), and Net Banking are supported."})]}),e.jsxs("div",{className:"mb-6 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"terms",defaultChecked:!0,className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsxs("label",{htmlFor:"terms",className:"text-sm text-gray-600 cursor-pointer",children:["I agree to the ",e.jsx("span",{className:"text-primary hover:underline",children:"Terms and Conditions"})]})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx(se,{amount:k,onBeforePayment:D,onError:t=>l(t)}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2 text-xs text-gray-500",children:[e.jsx(B,{size:12}),e.jsx("span",{children:"Your payment information is encrypted and secure"})]})]})]})})})]}),e.jsx("div",{className:"pt-6 border-t border-gray-100",children:e.jsxs(q,{onClick:()=>i("/checkout/shipping"),disabled:x,className:"px-6 py-3 rounded-xl font-bold text-gray-600 hover:bg-gray-100 transition-all border border-gray-200 flex items-center gap-2 w-full md:w-auto justify-center md:justify-start",children:[e.jsx(ee,{size:20})," Back to Shipping"]})})]})]})})})}export{oe as default};
