import{u as L,c as P,a as A,j as e}from"./index-DsP1R5yV.js";import{b as R,r as n,R as D}from"./vendor-react-B8KVy-C4.js";import{C as S}from"./CheckoutStepIndicator-BMjnIS6w.js";import{A as k}from"./AnimatedPage-D9f9vAm_.js";import{A as x}from"./AnimatedButton-BHsbnN3-.js";import{S as q}from"./ScrollReveal-CR-2c4a2.js";import{c as z,h as F,k as $,f as T}from"./vendor-ui-DMuw5F6C.js";import"./vendor-utils-C0Zqfgkc.js";function W(){var b,f,j,v,N,w;const d=R(),{cart:a}=L(),{checkoutData:r,updateShippingMethod:C,updateStep:M,setErrorMessage:l,clearError:o,setShippingOptions:c}=P(),[i,p]=n.useState(r.shippingMethod||null),[h,m]=n.useState([]),[E,g]=n.useState(!0),[y,u]=n.useState(!1);n.useEffect(()=>{if(!r.address){d("/checkout/address");return}O()},[r.address,d]);const O=D.useCallback(async()=>{try{g(!0),o();const{data:s}=await A.post("/shipping/serviceability",{pincode:r.address.pincode,weight:.5});m(s.shippingOptions||[]),c(s.shippingOptions||[]),s.shippingOptions&&s.shippingOptions.length>0&&(r.shippingMethod||p(s.shippingOptions[0].type))}catch(s){console.error("Error fetching shipping rates:",s),l("Failed to load shipping options");const t=[{type:"Standard",days:"3-5",charge:40,description:"Standard Delivery (3-5 days)"},{type:"Express",days:"1-2",charge:100,description:"Express Delivery (1-2 days)"}];m(t),c(t),r.shippingMethod||p("Standard")}finally{g(!1)}},[r.address,r.shippingMethod,o,l,c]),I=async()=>{if(!i){l("Please select a shipping method");return}try{u(!0),o();const s=h.find(t=>t.type===i);s&&(C(i,s.charge),M(3),d("/checkout/payment"))}catch(s){console.error("Error:",s),l("Failed to proceed")}finally{u(!1)}};return E?e.jsx(k,{children:e.jsx("div",{className:"bg-background min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsx(S,{}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading shipping options..."})]})]})})}):e.jsx(k,{children:e.jsx("div",{className:"bg-background min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsx(S,{}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl font-serif font-bold text-gray-900 mb-6",children:"Shipping Method"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 md:p-6 mb-8 border border-gray-200 flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase flex items-center gap-2 mb-2",children:[e.jsx(z,{size:16})," Delivering to:"]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:(b=r.address)==null?void 0:b.fullName}),e.jsxs("div",{className:"text-sm text-gray-600",children:[(f=r.address)==null?void 0:f.houseNumber,((j=r.address)==null?void 0:j.landmark)&&`, ${r.address.landmark}`,",",(v=r.address)==null?void 0:v.city,", ",(N=r.address)==null?void 0:N.state," - ",(w=r.address)==null?void 0:w.pincode]})]})]}),e.jsx(x,{onClick:()=>d("/checkout/address"),className:"text-primary font-bold text-sm hover:underline border-none p-0 bg-transparent flex items-center gap-1",children:"Change"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(F,{size:18,className:"text-primary"})," Select Shipping Method"]}),h.length===0?e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6 text-center text-yellow-800",children:e.jsx("p",{children:"No shipping options available for this pincode."})}):e.jsx("div",{className:"space-y-4",children:h.map((s,t)=>e.jsx(q,{delay:t*.1,children:e.jsxs("div",{className:`border-2 rounded-xl p-4 md:p-6 cursor-pointer transition-all flex items-center gap-4 ${i===s.type?"border-primary bg-primary/5 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>p(s.type),children:[e.jsx("div",{className:"relative flex items-center justify-center w-6 h-6 rounded-full border-2 border-gray-300",children:i===s.type&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-lg",children:s.description}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Estimated delivery in ",s.days," days"]})]}),e.jsx("div",{className:"text-xl font-bold text-primary",children:s.charge===0?"Free":`₹${s.charge}`})]})})]})},s.type))})]}),(a==null?void 0:a.cartItems)&&a.cartItems.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 mb-8 border border-gray-200 max-w-md ml-auto",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-4",children:"Price Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",a.cartItems.reduce((s,t)=>s+t.price*t.qty,0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{className:r.shippingCost===0?"text-green-600":"",children:r.shippingCost===0?"Free":`₹${r.shippingCost}`})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tax (18%)"}),e.jsxs("span",{children:["₹",(Math.round(a.cartItems.reduce((s,t)=>s+t.price*t.qty,0)*.18*100)/100).toLocaleString()]})]}),e.jsxs("div",{className:"border-t border-gray-200 my-2 pt-2 flex justify-between font-bold text-gray-900 text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",(a.cartItems.reduce((s,t)=>s+t.price*t.qty,0)+(r.shippingCost||0)+Math.round(a.cartItems.reduce((s,t)=>s+t.price*t.qty,0)*.18*100)/100).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse md:flex-row justify-between gap-4 pt-6 border-t border-gray-100",children:[e.jsxs(x,{onClick:()=>d("/checkout/address"),className:"px-6 py-3 rounded-xl font-bold text-gray-600 hover:bg-gray-100 transition-all border border-gray-200 flex items-center justify-center gap-2",children:[e.jsx($,{size:20})," Back to Address"]}),e.jsxs(x,{onClick:I,disabled:!i||y,className:"px-8 bg-primary text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-opacity-90 hover:shadow-xl transition-all transform hover:-translate-y-1 disabled:bg-gray-300 disabled:cursor-not-allowed border-none flex items-center justify-center gap-2",children:[y?"Processing...":"Continue to Payment"," ",e.jsx(T,{size:20})]})]})]})]})})})}export{W as default};
