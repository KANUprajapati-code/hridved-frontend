import{j as e,a as N,b as q,u as E,c as T}from"./index-jnhJKHVM.js";import{r as v,b as U,L as V}from"./vendor-react-B8KVy-C4.js";import{C as $}from"./CheckoutStepIndicator-Cp6X1t7s.js";import{A as H}from"./AnimatedPage-DxUsQqoh.js";import{A as M}from"./AnimatedButton-CtjKepQT.js";import{S as _}from"./ScrollReveal-o9tXFi3p.js";import{D as W,f as G,x as Q,c as Y,z as J,g as K,B as F,k as X}from"./vendor-ui-cGIEGKxt.js";import"./vendor-utils-C0Zqfgkc.js";const Z=({amount:n,orderId:A,onSuccess:s,onError:r,onBeforePayment:P})=>{const[l,y]=v.useState(!1),w=async()=>{var g,k;try{y(!0);let i=A;if(P){const t=await P();if(!t)return;i=t._id}const{data:u}=await N.get("/razorpay/key"),{data:m}=await N.post("/razorpay/order",{amount:n,currency:"INR",receipt:`receipt_${i}`}),z={key:u,amount:m.amount,currency:m.currency,name:"HRIDVED",description:"Ayurvedic Health & Wellness",image:"/logo-asset4.png",order_id:m.id,handler:async function(t){var p,x;try{const{data:d}=await N.post("/razorpay/verify",{razorpay_order_id:t.razorpay_order_id,razorpay_payment_id:t.razorpay_payment_id,razorpay_signature:t.razorpay_signature,orderId:i});if(d.status==="success")s&&s(d),window.location.href=`/checkout/success?id=${i}`;else throw new Error(d.message||"Verification failed")}catch(d){console.error("Verification Error:",d),r&&r(((x=(p=d.response)==null?void 0:p.data)==null?void 0:x.message)||d.message),window.location.href="/checkout/failed"}},prefill:{name:"User Name",email:"user@example.com",contact:"9999999999"},theme:{color:"#2D5A27"}},f=new window.Razorpay(z);f.on("payment.failed",function(t){console.error("Payment Failed:",t.error),r&&r(t.error.description),window.location.href="/checkout/failed"}),f.open()}catch(i){console.error("Payment Initiation Failed:",i),r&&r(((k=(g=i.response)==null?void 0:g.data)==null?void 0:k.message)||"Something went wrong")}finally{y(!1)}};return e.jsx(M,{onClick:w,disabled:l,className:"w-full bg-primary text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-opacity-90 hover:shadow-xl transition-all flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed border-none",children:l?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"animate-spin",size:20}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Pay ₹",n.toLocaleString()," ",e.jsx(G,{size:20})]})})};function ne(){var x,d,L,D,R,O,B;const n=U(),{user:A}=q(),{cart:s}=E(),{checkoutData:r,updateStep:P,setErrorMessage:l,clearError:y,setOrderId:w}=T(),[g]=v.useState(!1),[k,i]=v.useState(!1);v.useEffect(()=>{if(!r.address||!r.shippingMethod){n("/checkout/address");return}if(!(s!=null&&s.cartItems)||s.cartItems.length===0){n("/cart");return}},[r,n,s]);const u=()=>{const h=((s==null?void 0:s.cartItems)||[]).reduce((S,j)=>S+j.price*j.qty,0),c=0,b=r.shippingCost||0,I=h+c+b;return{itemsPrice:h,taxPrice:c,shippingPrice:b,totalPrice:I}},m=async()=>{var a,h;try{i(!0),y();const{itemsPrice:c,taxPrice:b,shippingPrice:I,totalPrice:S}=u(),j=(s==null?void 0:s.cartItems)||[],{data:C}=await N.post("/checkout/create-order",{addressId:r.address._id,deliveryOption:r.shippingMethod,orderItems:j.map(o=>({name:o.name,qty:o.qty,image:o.image,price:o.price,product:o.product||o._id})),itemsPrice:c,taxPrice:b,shippingPrice:I,totalPrice:S});return w(C._id,C),C}catch(c){throw console.error("Error creating order:",c),l(((h=(a=c.response)==null?void 0:a.data)==null?void 0:h.message)||"Failed to create order"),c}finally{i(!1)}},z=async a=>{a&&a.preventDefault()},{itemsPrice:f,shippingPrice:t,totalPrice:p}=u();return e.jsx(H,{children:e.jsx("div",{className:"bg-background min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-5xl",children:[e.jsx($,{}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl font-serif font-bold text-gray-900 mb-6",children:"Payment"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{children:e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-4 flex items-center gap-2",children:[e.jsx(Q,{size:16})," Order Summary"]}),e.jsx("div",{className:"space-y-4 mb-4",children:(s==null?void 0:s.cartItems)&&s.cartItems.map(a=>e.jsxs("div",{className:"flex justify-between items-start pb-4 border-b border-gray-200 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-sm",children:a.name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Qty: ",a.qty]})]}),e.jsxs("div",{className:"font-bold text-gray-900 text-sm",children:["₹",(a.price*a.qty).toLocaleString()]})]},a.product||a._id))}),e.jsxs("div",{className:"space-y-2 text-sm pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",f.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",t.toLocaleString()]})]}),e.jsxs("div",{className:"border-t border-gray-200 my-2 pt-2 flex justify-between font-bold text-gray-900 text-lg",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["₹",p.toLocaleString()]})]})]})]})}),e.jsx(_,{delay:.1,children:e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-4 flex items-center gap-2",children:[e.jsx(Y,{size:16})," Delivery Address"]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:(x=r.address)==null?void 0:x.fullName}),e.jsxs("p",{children:[(d=r.address)==null?void 0:d.houseNumber,((L=r.address)==null?void 0:L.landmark)&&`, ${r.address.landmark}`]}),e.jsxs("p",{children:[(D=r.address)==null?void 0:D.city,", ",(R=r.address)==null?void 0:R.state," - ",(O=r.address)==null?void 0:O.pincode]}),e.jsx("p",{className:"pt-1 font-medium text-gray-700",children:(B=r.address)==null?void 0:B.mobileNumber})]})]})})]}),e.jsx("div",{children:e.jsx(_,{delay:.2,children:e.jsxs("form",{onSubmit:z,className:"bg-white rounded-xl border-2 border-primary/10 p-6 md:p-8 shadow-sm h-full flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(J,{size:20,className:"text-primary"})," Select Payment Method"]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center p-4 border-2 border-primary bg-primary/5 rounded-xl cursor-pointer transition-all relative",children:[e.jsx("div",{className:"absolute top-3 right-3 text-primary",children:e.jsx("div",{className:"bg-primary text-white rounded-full p-1",children:e.jsx(K,{size:14,strokeWidth:3})})}),e.jsx("input",{type:"radio",name:"paymentMethod",value:"razorpay",defaultChecked:!0,className:"w-5 h-5 accent-primary mr-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:"Credit / Debit Card / UPI"}),e.jsx("div",{className:"text-xs text-primary font-bold bg-white border border-primary px-2 py-0.5 rounded inline-block mt-1",children:"Razorpay Secured"})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 text-sm text-gray-600 flex gap-3 items-start",children:[e.jsx(F,{size:16,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{children:"Secure payment via Razorpay. All major credit/debit cards, UPI (Google Pay, PhonePe, Paytm), and Net Banking are supported."})]}),e.jsxs("div",{className:"mb-6 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"terms",defaultChecked:!0,className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsxs("label",{htmlFor:"terms",className:"text-sm text-gray-600 cursor-pointer",children:["I agree to the ",e.jsx(V,{to:"/terms",target:"_blank",className:"text-primary hover:underline",children:"Terms and Conditions"})]})]}),e.jsxs("div",{className:"mt-auto",children:[e.jsx(Z,{amount:p,onBeforePayment:m,onError:a=>l(a)}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2 text-xs text-gray-500",children:[e.jsx(F,{size:12}),e.jsx("span",{children:"Your payment information is encrypted and secure"})]})]})]})})})]}),e.jsx("div",{className:"pt-6 border-t border-gray-100",children:e.jsxs(M,{onClick:()=>n("/checkout/shipping"),disabled:g,className:"px-6 py-3 rounded-xl font-bold text-gray-600 hover:bg-gray-100 transition-all border border-gray-200 flex items-center gap-2 w-full md:w-auto justify-center md:justify-start",children:[e.jsx(X,{size:20})," Back to Shipping"]})})]})]})})})}export{ne as default};
